cscope 15 $HOME/os161/src/userland/testbin/badcall               0000042808
	@bad_chdir.c

34 
	~<uni¡d.h
>

35 
	~<”ºo.h
>

36 
	~<”r.h
>

38 
	~"‹¡.h
"

42 
	$chdœ_em±y
()

44 
rv
;

50 
rv
 = 
	`chdœ
("");

51 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 
EINVAL
, 0, "chdiroƒmpty string");

52 
	}
}

55 
	$‹¡_chdœ
()

57 
	`‹¡_chdœ_·th
();

58 
	`chdœ_em±y
();

59 
	}
}

	@bad_close.c

34 
	~"‹¡.h
"

37 
	$‹¡_şo£
()

39 
	`‹¡_şo£_fd
();

40 
	}
}

	@bad_dup2.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<lim™s.h
>

41 
	~<”ºo.h
>

42 
	~<”r.h
>

44 
	~"cÚfig.h
"

45 
	~"‹¡.h
"

49 
	$dup2_fd2
(
fd
, cÚ¡ *
desc
)

51 
rv
;

53 
rv
 = 
	`dup2
(
STDIN_FILENO
, 
fd
);

54 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EBADF
, 
desc
);

56 ià(
rv
 != -1) {

57 
	`şo£
(
fd
);

59 
	}
}

63 
	$dup2_£lf
()

65 
¡©
 
sb
;

66 
rv
;

67 
‹¡fd
;

70 
‹¡fd
 = 
CLOSED_FD
;

72 
rv
 = 
	`dup2
(
STDIN_FILENO
, 
‹¡fd
);

73 ià(
rv
 == -1) {

74 
	`w¬n
("UH-OH: couldn't copy stdin");

78 
rv
 = 
	`dup2
(
‹¡fd
,estfd);

79 ià(
rv
 =ğ
‹¡fd
) {

80 
	`w¬nx
("passed: dup2o same fd");

82 ià(
rv
<0) {

83 
	`w¬n
("FAILURE: dup2o same fd:ƒrror");

86 
	`w¬nx
("FAILURE: dup2Ø§mfd:„‘uºed %d in¡—d", 
rv
);

89 
rv
 = 
	`f¡©
(
‹¡fd
, &
sb
);

90 ià(
rv
==0) {

91 
	`w¬nx
("passed: fstat fd‡fter dup2o itself");

93 ià(
”ºo
 !ğ
ENOSYS
) {

94 
	`w¬n
("FAILURE: fstat fd‡fter dup2o itself");

98 
rv
 = 
	`l£ek
(
‹¡fd
, 0, 
SEEK_CUR
);

99 ià(
rv
==0 || (rv==-1 && 
”ºo
==
ESPIPE
)) {

100 
	`w¬nx
("passed:†seek fd‡fter dup2o itself");

103 
	`w¬n
("FAILURE:†seek fd‡fter dup2o itself");

107 
	`şo£
(
‹¡fd
);

108 
	}
}

111 
	$‹¡_dup2
()

114 
	`‹¡_dup2_fd
();

117 
	`dup2_fd2
(-1, "dup2o -1");

118 
	`dup2_fd2
(-5, "dup2o -5");

119 
	`dup2_fd2
(
IMPOSSIBLE_FD
, "dup2o impossible fd");

120 #ifdeà
OPEN_MAX


121 
	`dup2_fd2
(
OPEN_MAX
, "dup2o OPEN_MAX");

123 
	`w¬nx
("Warning: OPEN_MAX‚ot defined -est skipped");

126 
	`dup2_£lf
();

127 
	}
}

	@bad_execv.c

34 
	~<sys/ty³s.h
>

35 
	~<¡dlib.h
>

36 
	~<uni¡d.h
>

37 
	~<”ºo.h
>

38 
	~<”r.h
>

40 
	~"cÚfig.h
"

41 
	~"‹¡.h
"

45 
	$exec_commÚ_fÜk
()

47 
pid
, 
rv
, 
¡©us
;

49 
pid
 = 
	`fÜk
();

50 ià(
pid
<0) {

51 
	`w¬n
("UH-OH: fork failed");

55 ià(
pid
==0) {

60 
rv
 = 
	`wa™pid
(
pid
, &
¡©us
, 0);

61 ià(
rv
 == -1) {

62 
	`w¬n
("UH-OH: waitpid failed");

65 ià(!
	`WIFEXITED
(
¡©us
è|| 
	`WEXITSTATUS
(¡©usè!ğ
MAGIC_STATUS
) {

66 
	`w¬nx
("FAILURE: wrongƒxit code of subprocess");

69 
	}
}

73 
	$exec_bad´og
(cÚ¡ *
´og
, cÚ¡ *
desc
)

75 
rv
;

76 *
¬gs
[2];

77 
¬gs
[0] = (*)"foo";

78 
¬gs
[1] = 
NULL
;

80 ià(
	`exec_commÚ_fÜk
() != 0) {

84 
rv
 = 
	`execv
(
´og
, 
¬gs
);

85 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EFAULT
, 
desc
);

86 
	`ex™
(
MAGIC_STATUS
);

87 
	}
}

91 
	$exec_em±y´og
()

93 
rv
;

94 *
¬gs
[2];

95 
¬gs
[0] = (*)"foo";

96 
¬gs
[1] = 
NULL
;

98 ià(
	`exec_commÚ_fÜk
() != 0) {

102 
rv
 = 
	`execv
("", 
¬gs
);

103 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 
EINVAL
, 
EISDIR
, "execheƒmpty string");

104 
	`ex™
(
MAGIC_STATUS
);

105 
	}
}

109 
	$exec_bad¬gs
(*
¬gs
, cÚ¡ *
desc
)

111 
rv
;

113 ià(
	`exec_commÚ_fÜk
() != 0) {

117 
rv
 = 
	`execv
("/bš/Œue", 
¬gs
);

118 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EFAULT
, 
desc
);

119 
	`ex™
(
MAGIC_STATUS
);

120 
	}
}

124 
	$exec_Ú—rg
(*
±r
, cÚ¡ *
desc
)

126 
rv
;

128 *
¬gs
[3];

129 
¬gs
[0] = (*)"foo";

130 
¬gs
[1] = (*)
±r
;

131 
¬gs
[2] = 
NULL
;

133 ià(
	`exec_commÚ_fÜk
() != 0) {

137 
rv
 = 
	`execv
("/bš/Œue", 
¬gs
);

138 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EFAULT
, 
desc
);

139 
	`ex™
(
MAGIC_STATUS
);

140 
	}
}

143 
	$‹¡_execv
()

145 
	`exec_bad´og
(
NULL
, "exec NULL");

146 
	`exec_bad´og
(
INVAL_PTR
, "exec invalid…ointer");

147 
	`exec_bad´og
(
KERN_PTR
, "exec kernel…ointer");

149 
	`exec_em±y´og
();

151 
	`exec_bad¬gs
(
NULL
, "exec /bin/true with NULL‡rglist");

152 
	`exec_bad¬gs
(
INVAL_PTR
, "exec /bin/true with invalid…ointer‡rglist");

153 
	`exec_bad¬gs
(
KERN_PTR
, "exec /bin/true with kernel…ointer‡rglist");

155 
	`exec_Ú—rg
(
INVAL_PTR
, "exec /bin/true with invalid…ointer‡rg");

156 
	`exec_Ú—rg
(
KERN_PTR
, "exec /bin/true with kernel…ointer‡rg");

157 
	}
}

	@bad_fsync.c

34 
	~"‹¡.h
"

37 
	$‹¡_fsync
()

39 
	`‹¡_fsync_fd
();

40 
	}
}

	@bad_ftruncate.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<”ºo.h
>

41 
	~<”r.h
>

43 
	~"cÚfig.h
"

44 
	~"‹¡.h
"

48 
	$árunÿ‹_fd_deviû
()

50 
rv
, 
fd
;

52 
fd
 = 
	`İ’
("nuÎ:", 
O_RDWR
);

53 ià(
fd
<0) {

54 
	`w¬n
("UH-OH: opening‚ull: failed");

58 
rv
 = 
	`árunÿ‹
(
fd
, 6);

59 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "ftruncate on device");

61 
	`şo£
(
fd
);

62 
	}
}

66 
	$árunÿ‹_size_Ãg
()

68 
rv
, 
fd
;

70 
fd
 = 
	`İ’_‹¡fe
(
NULL
);

71 ià(
fd
<0) {

75 
rv
 = 
	`árunÿ‹
(
fd
, -60);

76 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "ftruncateo‚egative size");

78 
	`şo£
(
fd
);

79 
	`»move
(
TESTFILE
);

80 
	}
}

83 
	$‹¡_árunÿ‹
()

85 
	`‹¡_árunÿ‹_fd
();

87 
	`árunÿ‹_fd_deviû
();

88 
	`árunÿ‹_size_Ãg
();

89 
	}
}

	@bad_getcwd.c

34 
	~"‹¡.h
"

37 
	$‹¡_g‘cwd
()

39 
	`‹¡_g‘cwd_buf
();

40 
	}
}

	@bad_getdirentry.c

34 
	~"‹¡.h
"

37 
	$‹¡_g‘dœ’Œy
()

39 
	`‹¡_g‘dœ’Œy_fd
();

40 
	`‹¡_g‘dœ’Œy_buf
();

41 
	}
}

	@bad_ioctl.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/ioùl.h
>

36 
	~<uni¡d.h
>

37 
	~<¡dio.h
>

38 
	~<”ºo.h
>

40 
	~"cÚfig.h
"

41 
	~"‹¡.h
"

45 
	$Úe_ioùl_badbuf
(
fd
, 
code
, cÚ¡ *
cod’ame
,

46 *
±r
, cÚ¡ *
±rdesc
)

48 
desc
[128];

49 
rv
;

51 
	`¢´štf
(
desc
, (desc), "ioùÈ% w™h %s", 
cod’ame
, 
±rdesc
);

52 
rv
 = 
	`ioùl
(
fd
, 
code
, 
±r
);

53 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EFAULT
, 
desc
);

54 
	}
}

58 
	$ªy_ioùl_badbuf
(
fd
, 
code
, cÚ¡ *
cod’ame
)

60 
	`Úe_ioùl_badbuf
(
fd
, 
code
, 
cod’ame
, 
NULL
, "NULL…ointer");

61 
	`Úe_ioùl_badbuf
(
fd
, 
code
, 
cod’ame
, 
INVAL_PTR
, "invalid…ointer");

62 
	`Úe_ioùl_badbuf
(
fd
, 
code
, 
cod’ame
, 
KERN_PTR
, "kernel…ointer");

63 
	}
}

65 
	#IOCTL
(
fd
, 
sym
è
	`ªy_ioùl_badbuf
(fd, sym, #sym)

	)

69 
	$ioùl_badbuf
()

82 ()
ªy_ioùl_badbuf
;

83 
	}
}

87 
	$ioùl_badcode
()

89 
rv
;

90 
rv
 = 
	`ioùl
(
STDIN_FILENO
, 
NONEXIST_IOCTL
, 
NULL
);

91 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EIOCTL
, "invalid ioctl");

92 
	}
}

95 
	$‹¡_ioùl
()

97 
	`‹¡_ioùl_fd
();

100 
	`ioùl_badcode
();

101 
	`ioùl_badbuf
();

102 
	}
}

	@bad_link.c

34 
	~<uni¡d.h
>

35 
	~<”ºo.h
>

37 
	~"‹¡.h
"

41 
	$lšk_dœ
()

43 
rv
;

44 
rv
 = 
	`lšk
(".", 
TESTDIR
);

45 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "hard†ink of .");

46 ià(
rv
==0) {

48 
	`»move
(
TESTDIR
);

50 
	}
}

54 
	$lšk_em±y1
()

56 
rv
;

57 
rv
 = 
	`lšk
("", 
TESTDIR
);

58 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "hard†ink ofƒmpty string");

59 
	}
}

63 
	$lšk_em±y2
()

65 
rv
;

66 ià(
	`ü—‹_‹¡dœ
()<0) {

69 
rv
 = 
	`lšk
(
TESTDIR
, "");

70 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "hard†inkoƒmpty string");

71 
	`rmdœ
(
TESTDIR
);

72 
	}
}

75 
	$‹¡_lšk
()

77 
	`‹¡_lšk_·ths
();

78 
	`lšk_dœ
();

79 
	`lšk_em±y1
();

80 
	`lšk_em±y2
();

81 
	}
}

	@bad_lseek.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<”ºo.h
>

41 
	~<”r.h
>

43 
	~"cÚfig.h
"

44 
	~"‹¡.h
"

48 
	$l£ek_fd_deviû
()

50 
fd
, 
rv
;

52 
fd
 = 
	`İ’
("nuÎ:", 
O_RDONLY
);

53 ià(
fd
<0) {

54 
	`w¬n
("UH-OH: opening‚ull: failed");

58 
rv
 = 
	`l£ek
(
fd
, 309, 
SEEK_SET
);

59 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
ESPIPE
, "lseek on device");

61 
	`şo£
(
fd
);

62 
	}
}

66 
	$l£ek_fe_¡dš
()

68 
fd
, 
fd2
, 
rv
, 
¡©us
;

69 cÚ¡ 
¦ogª
[] = "There‡in't‚o suchhing‡s‡ free†unch";

70 
size_t
 
Ën
 = 
	`¡¾’
(
¦ogª
);

71 
pid_t
 
pid
;

74 
pid
 = 
	`fÜk
();

75 ià(
pid
<0) {

76 
	`w¬n
("UH-OH: fork failed");

79 ià(
pid
!=0) {

81 
rv
 = 
	`wa™pid
(
pid
, &
¡©us
, 0);

82 ià(
rv
<0) {

83 
	`w¬n
("UH-OH: waitpid failed");

85 ià(
	`WIFSIGNALED
(
¡©us
)) {

86 
	`w¬n
("UH-OH: subprocessƒxited with signal %d",

87 
	`WTERMSIG
(
¡©us
));

89 ià(
	`WIFEXITED
(
¡©us
è&& 
	`WEXITSTATUS
(status) != 0) {

90 
	`w¬n
("UH-OH: subprocessƒxited with code %d",

91 
	`WEXITSTATUS
(
¡©us
));

98 
fd
 = 
	`İ’_‹¡fe
(
NULL
);

99 ià(
fd
<0) {

100 
	`_ex™
(0);

110 
fd2
 = 
	`dup2
(
fd
, 
STDIN_FILENO
);

111 ià(
fd2
<0) {

112 
	`w¬n
("UH-OH: dup2o stdin failed");

113 
	`şo£
(
fd
);

114 
	`»move
(
TESTFILE
);

115 
	`_ex™
(0);

117 ià(
fd2
 !ğ
STDIN_FILENO
) {

118 
	`w¬n
("UH-OH: dup2„eturned wrong file handle");

119 
	`şo£
(
fd
);

120 
	`»move
(
TESTFILE
);

121 
	`_ex™
(0);

123 
	`şo£
(
fd
);

125 
rv
 = 
	`wr™e
(
STDIN_FILENO
, 
¦ogª
, 
Ën
);

126 ià(
rv
<0) {

127 
	`w¬n
("UH-OH: wr™tØ% (vŸ stdšèçed", 
TESTFILE
);

128 
	`»move
(
TESTFILE
);

129 
	`_ex™
(0);

132 ià(()
rv
 !ğ
Ën
) {

133 
	`w¬nx
("UH-OH: writeo %s (via stdin) got short count",

134 
TESTFILE
);

135 
	`»move
(
TESTFILE
);

136 
	`_ex™
(0);

139 
rv
 = 
	`l£ek
(
STDIN_FILENO
, 0, 
SEEK_SET
);

140 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 0, "lseek stdin when open on file (try 1)");

142 
rv
 = 
	`l£ek
(
STDIN_FILENO
, 0, 
SEEK_END
);

143 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 0, "lseek stdin when open on file (try 2)");

145 
	`»move
(
TESTFILE
);

146 
	`_ex™
(0);

147 
	}
}

151 
	$l£ek_loc_Ãg©ive
()

153 
fd
, 
rv
;

155 
fd
 = 
	`İ’_‹¡fe
(
NULL
);

156 ià(
fd
<0) {

160 
rv
 = 
	`l£ek
(
fd
, -309, 
SEEK_SET
);

161 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "lseeko‚egative offset");

163 
	`şo£
(
fd
);

164 
	`»move
(
TESTFILE
);

165 
	}
}

169 
	$l£ek_wh’û_šv®
()

171 
fd
, 
rv
;

173 
fd
 = 
	`İ’_‹¡fe
(
NULL
);

174 ià(
fd
<0) {

178 
rv
 = 
	`l£ek
(
fd
, 0, 3594);

179 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "lseek with invalid whence code");

181 
	`şo£
(
fd
);

182 
	`»move
(
TESTFILE
);

183 
	}
}

187 
	$l£ek_loc_·¡eof
()

189 cÚ¡ *
mes§ge
 = "blahblah";

190 
fd
;

191 
off_t
 
pos
;

193 
fd
 = 
	`İ’_‹¡fe
(
mes§ge
);

194 ià(
fd
<0) {

198 
pos
 = 
	`l£ek
(
fd
, 5340, 
SEEK_SET
);

199 ià(
pos
 == -1) {

200 
	`w¬n
("FAILURE:†seek…ast EOF failed");

201 
out
;

203 ià(
pos
 != 5340) {

204 
	`w¬nx
("FAILURE:†£ekØ5340 gÙ off£ˆ%ld", (è
pos
);

205 
out
;

208 
pos
 = 
	`l£ek
(
fd
, -50, 
SEEK_CUR
);

209 ià(
pos
 == -1) {

210 
	`w¬n
("FAILURE: small seek beyond EOF failed");

211 
out
;

213 ià(
pos
 != 5290) {

214 
	`w¬nx
("FAILURE: SEEK_CURØ5290 gÙ off£ˆ%ld", (è
pos
);

215 
out
;

218 
pos
 = 
	`l£ek
(
fd
, 0, 
SEEK_END
);

219 ià(
pos
 == -1) {

220 
	`w¬n
("FAILURE: seeko EOF failed");

221 
out
;

224 ià(
pos
 !ğ(
off_t
è
	`¡¾’
(
mes§ge
)) {

225 
	`w¬nx
("FAILURE: seeko EOF got %ld (should be %d)",

226 (è
pos
, 
	`¡¾’
(
mes§ge
));

227 
out
;

230 
	`w¬nx
("passed: seek…ast/to EOF");

232 
out
:

233 
	`şo£
(
fd
);

234 
	`»move
(
TESTFILE
);

236 
	}
}

239 
	$‹¡_l£ek
()

241 
	`‹¡_l£ek_fd
();

243 
	`l£ek_fd_deviû
();

244 
	`l£ek_fe_¡dš
();

245 
	`l£ek_loc_Ãg©ive
();

246 
	`l£ek_loc_·¡eof
();

247 
	`l£ek_wh’û_šv®
();

248 
	}
}

	@bad_mkdir.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<”ºo.h
>

41 
	~<”r.h
>

43 
	~"cÚfig.h
"

44 
	~"‹¡.h
"

48 
	$mkdœ_dÙ
()

50 
rv
;

52 
rv
 = 
	`mkdœ
(".", 0775);

53 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EEXIST
, "mkdir .");

54 
	}
}

58 
	$mkdœ_dÙdÙ
()

60 
rv
;

62 
rv
 = 
	`mkdœ
("..", 0775);

63 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EEXIST
, "mkdir ..");

64 
	}
}

68 
	$mkdœ_em±y
()

70 
rv
;

71 
rv
 = 
	`mkdœ
("", 0775);

72 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "mkdir ofƒmpty string");

73 
	}
}

76 
	$‹¡_mkdœ
()

78 
	`‹¡_mkdœ_·th
();

80 
	`mkdœ_dÙ
();

81 
	`mkdœ_dÙdÙ
();

82 
	`mkdœ_em±y
();

83 
	}
}

	@bad_open.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<”ºo.h
>

41 
	~<”r.h
>

43 
	~"cÚfig.h
"

44 
	~"‹¡.h
"

48 
	$İ’_badæags
()

50 
fd
;

52 
fd
 = 
	`İ’
("null:", 309842);

53 
	`»pÜt_‹¡
(
fd
, 
”ºo
, 
EINVAL
, "open‚ull: with bad flags");

54 
	}
}

58 
	$İ’_em±y
()

60 
rv
;

61 
rv
 = 
	`İ’
("", 
O_RDONLY
);

62 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 0, 
EINVAL
, "openƒmpty string");

63 ià(
rv
>=0) {

64 
	`şo£
(
rv
);

66 
	}
}

69 
	$‹¡_İ’
()

71 
	`‹¡_İ’_·th
();

73 
	`İ’_badæags
();

74 
	`İ’_em±y
();

75 
	}
}

	@bad_pipe.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<”ºo.h
>

41 
	~<”r.h
>

43 
	~"cÚfig.h
"

44 
	~"‹¡.h
"

48 
	$pe_bad±r
(*
±r
, cÚ¡ *
desc
)

50 
rv
;

52 
rv
 = 
	`pe
(
±r
);

53 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EFAULT
, 
desc
);

54 
	}
}

58 
	$pe_uÇligÃd
()

60 
fds
[3], 
rv
;

61 *
±r
;

63 
±r
 = (*)&
fds
[0];

64 
±r
++;

66 
rv
 = 
	`pe
((*)
±r
);

67 
	`»pÜt_surviv®
(
rv
, 
”ºo
, "pipe with unaligned…ointer");

68 
	}
}

71 
	$‹¡_pe
()

73 
	`pe_bad±r
(
NULL
, "pipe with NULL…ointer");

74 
	`pe_bad±r
(
INVAL_PTR
, "pipe with invalid…ointer");

75 
	`pe_bad±r
(
KERN_PTR
, "pipe with kernel…ointer");

77 
	`pe_uÇligÃd
();

78 
	}
}

	@bad_read.c

34 
	~"‹¡.h
"

37 
	$‹¡_»ad
()

39 
	`‹¡_»ad_fd
();

40 
	`‹¡_»ad_buf
();

41 
	}
}

	@bad_readlink.c

34 
	~<uni¡d.h
>

35 
	~<”ºo.h
>

37 
	~"‹¡.h
"

41 
	$»adlšk_fe
()

43 
buf
[128];

44 
fd
, 
rv
;

46 
fd
 = 
	`İ’_‹¡fe
("the question contains‡n invalid‡ssumption");

47 ià(
fd
<0) {

50 
	`şo£
(
fd
);

51 
rv
 = 
	`»adlšk
(
TESTFILE
, 
buf
, (buf));

52 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "readlink on file");

53 
	`»move
(
TESTFILE
);

54 
	}
}

58 
	$»adlšk_dœ
()

60 
buf
[128];

61 
rv
;

62 
rv
 = 
	`»adlšk
(".", 
buf
, (buf));

63 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EISDIR
, "readlink on .");

64 
	}
}

68 
	$»adlšk_em±y
()

70 
buf
[128];

71 
rv
;

72 
rv
 = 
	`»adlšk
("", 
buf
, (buf));

73 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 
EISDIR
, 
EINVAL
, "readlink onƒmpty string");

74 
	}
}

77 
	$‹¡_»adlšk
()

79 
	`‹¡_»adlšk_·th
();

80 
	`‹¡_»adlšk_buf
();

82 
	`»adlšk_fe
();

83 
	`»adlšk_dœ
();

84 
	`»adlšk_em±y
();

85 
	}
}

	@bad_reboot.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<”ºo.h
>

41 
	~<”r.h
>

43 
	~"cÚfig.h
"

44 
	~"‹¡.h
"

48 
	$»boÙ_badæags
()

50 
rv
;

52 
	`w¬nx
("NOTICE: ifhis killshe system, it's‡ failure.");

53 
rv
 = 
	`»boÙ
(15353);

54 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "reboot with invalid flags");

55 
	}
}

58 
	$‹¡_»boÙ
()

60 
	`»boÙ_badæags
();

61 
	}
}

	@bad_remove.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<”ºo.h
>

41 
	~<”r.h
>

43 
	~"cÚfig.h
"

44 
	~"‹¡.h
"

48 
	$»move_dœ
()

50 
rv
;

52 ià(
	`ü—‹_‹¡dœ
() < 0) {

56 
rv
 = 
	`»move
(
TESTDIR
);

57 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EISDIR
, "remove() on‡ directory");

58 
	`rmdœ
(
TESTDIR
);

59 
	}
}

63 
	$»move_dÙ
()

65 
rv
;

66 
rv
 = 
	`»move
(".");

67 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 
EISDIR
, 
EINVAL
, "remove() on .");

68 
	}
}

72 
	$»move_dÙdÙ
()

74 
rv
;

75 
rv
 = 
	`»move
("..");

76 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 
EISDIR
, 
EINVAL
, "remove() on ..");

77 
	}
}

81 
	$»move_em±y
()

83 
rv
;

84 
rv
 = 
	`»move
("");

85 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 
EISDIR
, 
EINVAL
, "remove() onƒmpty string");

86 
	}
}

89 
	$‹¡_»move
()

91 
	`‹¡_»move_·th
();

93 
	`»move_dœ
();

94 
	`»move_dÙ
();

95 
	`»move_dÙdÙ
();

96 
	`»move_em±y
();

97 
	}
}

	@bad_rename.c

34 
	~<uni¡d.h
>

35 
	~<”ºo.h
>

37 
	~"‹¡.h
"

41 
	$»Çme_dÙ
()

43 
rv
;

44 
rv
 = 
	`»Çme
(".", 
TESTDIR
);

45 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "rename .");

46 ià(
rv
==0) {

48 
	`»Çme
(
TESTDIR
, ".");

50 
	}
}

54 
	$»Çme_dÙdÙ
()

56 
rv
;

57 
rv
 = 
	`»Çme
("..", 
TESTDIR
);

58 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "rename ..");

59 ià(
rv
==0) {

61 
	`»Çme
(
TESTDIR
, "..");

63 
	}
}

67 
	$»Çme_em±y1
()

69 
rv
;

70 
rv
 = 
	`»Çme
("", 
TESTDIR
);

71 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 
EISDIR
, 
EINVAL
, "renameƒmpty string");

72 ià(
rv
==0) {

74 
	`»Çme
(
TESTDIR
, TESTDIR "-foo");

76 
	}
}

80 
	$»Çme_em±y2
()

82 
rv
;

83 ià(
	`ü—‹_‹¡dœ
()<0) {

86 
rv
 = 
	`»Çme
(
TESTDIR
, "");

87 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 
EISDIR
, 
EINVAL
, "renameoƒmpty string");

88 
	`rmdœ
(
TESTDIR
);

89 
	}
}

92 
	$‹¡_»Çme
()

94 
	`‹¡_»Çme_·ths
();

96 
	`»Çme_dÙ
();

97 
	`»Çme_dÙdÙ
();

98 
	`»Çme_em±y1
();

99 
	`»Çme_em±y2
();

100 
	}
}

	@bad_rmdir.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<”ºo.h
>

41 
	~<”r.h
>

43 
	~"cÚfig.h
"

44 
	~"‹¡.h
"

48 
	$rmdœ_fe
()

50 
rv
;

51 ià(
	`ü—‹_‹¡fe
()<0) {

54 
rv
 = 
	`rmdœ
(
TESTFILE
);

55 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
ENOTDIR
, "rmdir‡ file");

56 
	`»move
(
TESTFILE
);

57 
	}
}

61 
	$rmdœ_dÙ
()

63 
rv
;

65 
rv
 = 
	`rmdœ
(".");

66 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "rmdir .");

67 
	}
}

71 
	$rmdœ_dÙdÙ
()

73 
rv
;

75 
rv
 = 
	`rmdœ
("..");

76 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 
EINVAL
, 
ENOTEMPTY
, "rmdir ..");

77 
	}
}

81 
	$rmdœ_em±y
()

83 
rv
;

84 
rv
 = 
	`rmdœ
("");

85 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "rmdirƒmpty string");

86 
	}
}

89 
	$‹¡_rmdœ
()

91 
	`‹¡_rmdœ_·th
();

93 
	`rmdœ_fe
();

94 
	`rmdœ_dÙ
();

95 
	`rmdœ_dÙdÙ
();

96 
	`rmdœ_em±y
();

97 
	}
}

	@bad_sbrk.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<”ºo.h
>

41 
	~<”r.h
>

43 
	~"cÚfig.h
"

44 
	~"‹¡.h
"

48 
	$Œy_sbrk
(
v®
)

50 *
rv
;

51 
rv
 = 
	`sbrk
(
v®
);

52 ià(
rv
==(*)-1) {

53  
”ºo
;

56 
	}
}

60 
	$’fÜû_sbrk
(
v®
, cÚ¡ *
desc
, 
”r
)

62 
e
;

64 
e
 = 
	`Œy_sbrk
(
v®
);

65 ià(
e
 !ğ
”r
 &&ƒ==0) {

66 
	`w¬nx
("FAILURE: sbrk(%s):‚Ø”rÜ", 
desc
);

69 ià(
e
 !ğ
”r
) {

70 
”ºo
 = 
e
;

71 
	`w¬n
("FAILURE: sbrk(%s): wrÚgƒ¼Ü", 
desc
);

74 
	`w¬nx
("·s£d: sbrk(%s)", 
desc
);

75 
	}
}

79 
	$sbrk_bigpos
()

81 
	`’fÜû_sbrk
(4096*1024*256, "hugpos™ive", 
ENOMEM
);

82 
	}
}

86 
	$sbrk_bigÃg
()

88 
	`’fÜû_sbrk
(-4096*1024*256, "hugÃg©ive", 
EINVAL
);

89 
	}
}

93 
	$sbrk_Ãg
()

95 
	`’fÜû_sbrk
(-8192, "too-ÏrgÃg©ive", 
EINVAL
);

96 
	}
}

100 
	$sbrk_uÇligÃdpos
()

102 
	`Œy_sbrk
(17)) {

104 
EINVAL
:

105 
	`w¬nx
("passed: sbrk(unaligned…ositive)");

108 
	`w¬n
("FAILURE: sbrk(unaligned…ositive): wrongƒrror");

111 
	}
}

115 
	$sbrk_uÇligÃdÃg
()

117 
	`Œy_sbrk
(-17)) {

119 
EINVAL
:

120 
	`w¬nx
("passed: sbrk(unaligned‚egative)");

123 
	`w¬n
("FAILURE: sbrk(unaligned‚egative): wrongƒrror");

126 
	}
}

129 
	$‹¡_sbrk
()

131 
	`sbrk_Ãg
();

132 
	`sbrk_bigpos
();

133 
	`sbrk_bigÃg
();

134 
	`sbrk_uÇligÃdpos
();

135 
	`sbrk_uÇligÃdÃg
();

136 
	}
}

	@bad_stat.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<”ºo.h
>

41 
	~<”r.h
>

43 
	~"cÚfig.h
"

44 
	~"‹¡.h
"

50 
	$badbuf_f¡©
(
¡©
 *
sb
)

52  
	`f¡©
(
STDIN_FILENO
, 
sb
);

53 
	}
}

57 
	$badbuf_l¡©
(
¡©
 *
sb
)

59  
	`l¡©
("nuÎ:", 
sb
);

60 
	}
}

64 
	$badbuf_¡©
(
¡©
 *
sb
)

66  
	`¡©
("nuÎ:", 
sb
);

67 
	}
}

71 
commÚ_badbuf
((*
¡©func
)(
¡©
 *), *
±r
,

72 cÚ¡ *
ÿÎ
, cÚ¡ *
±rdesc
)

74 
rv
;

75 
mydesc
[128];

77 
	`¢´štf
(
mydesc
, (mydesc), "% w™h % buf", 
ÿÎ
, 
±rdesc
);

78 
rv
 = 
	`¡©func
(
±r
);

79 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EFAULT
, 
mydesc
);

80 
	}
}

84 
ªy_badbuf
((*
¡©func
)(
¡©
 *), cÚ¡ *
ÿÎ
)

86 
	`commÚ_badbuf
(
¡©func
, 
NULL
, 
ÿÎ
, "NULL");

87 
	`commÚ_badbuf
(
¡©func
, 
INVAL_PTR
, 
ÿÎ
, "invalid…ointer");

88 
	`commÚ_badbuf
(
¡©func
, 
KERN_PTR
, 
ÿÎ
, "kernel…ointer");

89 
	}
}

95 
ªy_em±y
((*
¡©func
)(cÚ¡ *, 
¡©
 *), cÚ¡ *
ÿÎ
)

97 
¡©
 
sb
;

98 
desc
[128];

99 
rv
;

101 
	`¢´štf
(
desc
, (desc), "% Úƒm±y sŒšg", 
ÿÎ
);

102 
rv
 = 
	`¡©func
("", &
sb
);

103 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 0, 
EINVAL
, 
desc
);

104 
	}
}

109 
	$‹¡_f¡©
()

111 
	`‹¡_f¡©_fd
();

112 
	`ªy_badbuf
(
badbuf_f¡©
, "fstat");

113 
	}
}

116 
	$‹¡_l¡©
()

118 
	`‹¡_l¡©_·th
();

119 
	`ªy_em±y
(
l¡©
, "lstat");

120 
	`ªy_badbuf
(
badbuf_l¡©
, "lstat");

121 
	}
}

124 
	$‹¡_¡©
()

126 
	`‹¡_¡©_·th
();

127 
	`ªy_em±y
(
¡©
, "stat");

128 
	`ªy_badbuf
(
badbuf_¡©
, "stat");

129 
	}
}

	@bad_symlink.c

34 
	~<uni¡d.h
>

35 
	~<”ºo.h
>

37 
	~"‹¡.h
"

41 
	$symlšk_em±y1
()

43 
rv
;

44 
rv
 = 
	`symlšk
("", 
TESTLINK
);

45 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 0, 
EINVAL
, "symlink ->ƒmpty string");

46 
	`»move
(
TESTLINK
);

47 
	}
}

51 
	$symlšk_em±y2
()

53 
rv
;

54 
rv
 = 
	`symlšk
("foo", "");

55 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "symlink‚amedƒmpty string");

56 
	}
}

59 
	$‹¡_symlšk
()

61 
	`‹¡_symlšk_·ths
();

62 
	`symlšk_em±y1
();

63 
	`symlšk_em±y2
();

64 
	}
}

	@bad_time.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<”ºo.h
>

41 
	~<”r.h
>

43 
	~"cÚfig.h
"

44 
	~"‹¡.h
"

48 
	$time_bad£cs
(*
±r
, cÚ¡ *
desc
)

50 
rv
;

52 
rv
 = 
	`__time
(
±r
, 
NULL
);

53 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EFAULT
, 
desc
);

54 
	}
}

58 
	$time_badn£cs
(*
±r
, cÚ¡ *
desc
)

60 
rv
;

62 
rv
 = 
	`__time
(
NULL
, 
±r
);

63 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EFAULT
, 
desc
);

64 
	}
}

67 
	$‹¡_time
()

69 
	`time_bad£cs
(
INVAL_PTR
, "__time with invalid seconds…ointer");

70 
	`time_bad£cs
(
KERN_PTR
, "__time with kernel seconds…ointer");

72 
	`time_badn£cs
(
INVAL_PTR
, "__time with invalid‚secs…ointer");

73 
	`time_badn£cs
(
KERN_PTR
, "__time with kernel‚secs…ointer");

74 
	}
}

	@bad_waitpid.c

34 
	~<sys/ty³s.h
>

35 
	~<¡dio.h
>

36 
	~<¡dlib.h
>

37 
	~<uni¡d.h
>

38 
	~<”ºo.h
>

39 
	~<”r.h
>

41 
	~"cÚfig.h
"

42 
	~"‹¡.h
"

46 
	$wa™_badpid
(
pid_t
 
pid
, cÚ¡ *
desc
)

48 
pid_t
 
rv
;

49 
x
;

51 
rv
 = 
	`wa™pid
(
pid
, &
x
, 0);

53 ià(
pid
 <ğ0 && 
rv
 =ğ-1 && 
”ºo
 =ğ
ENOSYS
) {

54 
”ºo
 = 
ESRCH
;

56 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 
ESRCH
, 
ECHILD
, 
desc
);

57 
	}
}

61 
	$wa™_nuÎ¡©us
()

63 
pid_t
 
pid
, 
rv
;

64 
x
;

66 
pid
 = 
	`fÜk
();

67 ià(
pid
<0) {

68 
	`w¬n
("UH-OH: fork failed");

71 ià(
pid
==0) {

72 
	`ex™
(0);

76 
rv
 = 
	`wa™pid
(
pid
, 
NULL
, 0);

77 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 0, "wait with NULL status");

78 
	`wa™pid
(
pid
, &
x
, 0);

79 
	}
}

83 
	$wa™_bad¡©us
(*
±r
, cÚ¡ *
desc
)

85 
pid_t
 
pid
, 
rv
;

86 
x
;

88 
pid
 = 
	`fÜk
();

89 ià(
pid
<0) {

90 
	`w¬n
("UH-OH: fork failed");

93 ià(
pid
==0) {

94 
	`ex™
(0);

97 
rv
 = 
	`wa™pid
(
pid
, 
±r
, 0);

98 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EFAULT
, 
desc
);

99 
	`wa™pid
(
pid
, &
x
, 0);

100 
	}
}

104 
	$wa™_uÇligÃd
()

106 
pid_t
 
pid
, 
rv
;

107 
x
;

108 
¡©us
[2];

109 *
±r
;

111 
pid
 = 
	`fÜk
();

112 ià(
pid
<0) {

113 
	`w¬n
("UH-OH: fork failed");

116 ià(
pid
==0) {

117 
	`ex™
(0);

121 
±r
 = (*)(&
¡©us
[0]);

124 
±r
++;

126 
rv
 = 
	`wa™pid
(
pid
, (*)
±r
, 0);

127 
	`»pÜt_surviv®
(
rv
, 
”ºo
, "wait with unaligned status");

128 ià(
rv
<0) {

129 
	`wa™pid
(
pid
, &
x
, 0);

131 
	}
}

135 
	$wa™_badæags
()

137 
pid_t
 
pid
, 
rv
;

138 
x
;

140 
pid
 = 
	`fÜk
();

141 ià(
pid
<0) {

142 
	`w¬n
("UH-OH: fork failed");

145 ià(
pid
==0) {

146 
	`ex™
(0);

149 
rv
 = 
	`wa™pid
(
pid
, &
x
, 309429);

150 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "wait with bad flags");

151 
	`wa™pid
(
pid
, &
x
, 0);

152 
	}
}

156 
	$wa™_£lf
()

158 
pid_t
 
rv
;

159 
x
;

161 
rv
 = 
	`wa™pid
(
	`g‘pid
(), &
x
, 0);

162 
	`»pÜt_surviv®
(
rv
, 
”ºo
, "wait for self");

163 
	}
}

167 
	$wa™_·»Á
()

169 
pid_t
 
mypid
, 
chdpid
, 
rv
;

170 
x
;

172 
mypid
 = 
	`g‘pid
();

173 
chdpid
 = 
	`fÜk
();

174 ià(
chdpid
<0) {

175 
	`w¬n
("UH-OH: can't fork");

178 ià(
chdpid
==0) {

180 
rv
 = 
	`wa™pid
(
mypid
, &
x
, 0);

181 
	`»pÜt_surviv®
(
rv
, 
”ºo
, "wait for…arent (from child)");

182 
	`_ex™
(0);

184 
rv
 = 
	`wa™pid
(
chdpid
, &
x
, 0);

185 
	`»pÜt_surviv®
(
rv
, 
”ºo
, "wait for…arentest (from…arent)");

186 
	}
}

192 
	$wa™_siblšgs_chd
(cÚ¡ *
£mÇme
)

194 
pid_t
 
pids
[2], 
mypid
, 
Ùh”pid
;

195 
rv
, 
fd
, 
£mfd
, 
x
;

197 
mypid
 = 
	`g‘pid
();

204 
£mfd
 = 
	`İ’
(
£mÇme
, 
O_RDONLY
);

205 ià(
£mfd
 < 0) {

206 
	`w¬n
("UH-OH: child…rocess (pid %d) can't open %s",

207 
mypid
, 
£mÇme
);

210 ià(
	`»ad
(
£mfd
, 
NULL
, 1) < 0) {

211 
	`w¬n
("UH-OH: iÀpid %d: %s:„—d", 
mypid
, 
£mÇme
);

213 
	`şo£
(
£mfd
);

216 
fd
 = 
	`İ’
(
TESTFILE
, 
O_RDONLY
);

217 ià(
fd
<0) {

218 
	`w¬n
("UH-OH: child…rocess (pid %d) can't open %s",

219 
mypid
, 
TESTFILE
);

229 
rv
 = 
	`l£ek
(
fd
, 0, 
SEEK_SET
);

230 ià(
rv
<0) {

231 
	`w¬n
("UH-OH: child…rocess (pid %d)†seekƒrror",

232 
mypid
);

235 
rv
 = 
	`»ad
(
fd
, 
pids
, (pids));

236 ià(
rv
<0) {

237 
	`w¬n
("UH-OH: child…rocess (pid %d)„eadƒrror",

238 
mypid
);

241 } 
rv
 < ()(
pids
));

243 ià(
mypid
==
pids
[0]) {

244 
Ùh”pid
 = 
pids
[1];

246 ià(
mypid
==
pids
[1]) {

247 
Ùh”pid
 = 
pids
[0];

250 
	`w¬n
("UH-OH: child…rocess (pid %d) got garbage in comm file",

251 
mypid
);

254 
	`şo£
(
fd
);

256 
rv
 = 
	`wa™pid
(
Ùh”pid
, &
x
, 0);

257 
	`»pÜt_surviv®
(
rv
, 
”ºo
, "sibling wait");

258 
	}
}

262 
	$wa™_siblšgs
()

264 
pid_t
 
pids
[2];

265 
rv
, 
fd
, 
£mfd
, 
x
;

266 
£mÇme
[32];

270 
	`¢´štf
(
£mÇme
, (£mÇme), "£m:badÿÎ.%d", ()
	`g‘pid
());

271 
£mfd
 = 
	`İ’
(
£mÇme
, 
O_WRONLY
|
O_CREAT
|
O_TRUNC
, 0664);

272 ià(
£mfd
 < 0) {

273 
	`w¬n
("UH-OH: can't make semaphore");

277 
fd
 = 
	`İ’_‹¡fe
(
NULL
);

278 ià(
fd
<0) {

279 
	`şo£
(
£mfd
);

280 
	`»move
(
£mÇme
);

284 
pids
[0] = 
	`fÜk
();

285 ià(
pids
[0]<0) {

286 
	`w¬n
("UH-OH: can't fork");

287 
	`şo£
(
fd
);

288 
	`şo£
(
£mfd
);

289 
	`»move
(
£mÇme
);

292 ià(
pids
[0]==0) {

293 
	`şo£
(
fd
);

294 
	`şo£
(
£mfd
);

295 
	`wa™_siblšgs_chd
(
£mÇme
);

296 
	`_ex™
(0);

299 
pids
[1] = 
	`fÜk
();

300 ià(
pids
[1]<0) {

301 
	`w¬n
("UH-OH: can't fork");

303 
	`şo£
(
fd
);

304 
	`şo£
(
£mfd
);

305 
	`»move
(
£mÇme
);

308 ià(
pids
[1]==0) {

309 
	`şo£
(
fd
);

310 
	`şo£
(
£mfd
);

311 
	`wa™_siblšgs_chd
(
£mÇme
);

312 
	`_ex™
(0);

315 
rv
 = 
	`wr™e
(
fd
, 
pids
, (pids));

316 ià(
rv
 < 0) {

317 
	`w¬n
("UH-OH: wr™”rÜ oÀ%s", 
TESTFILE
);

319 
	`şo£
(
fd
);

320 
	`şo£
(
£mfd
);

321 
	`»move
(
£mÇme
);

324 ià(
rv
 !ğ()(
pids
)) {

325 
	`w¬nx
("UH-OH: wr™”rÜ oÀ%s: shÜˆcouÁ", 
TESTFILE
);

327 
	`şo£
(
fd
);

328 
	`şo£
(
£mfd
);

329 
	`»move
(
£mÇme
);

334 
rv
 = 
	`wr™e
(
£mfd
, 
NULL
, 2);

335 ià(
rv
 < 0) {

336 
	`w¬n
("UH-OH: %s: wr™e", 
£mÇme
);

339 
rv
 = 
	`wa™pid
(
pids
[0], &
x
, 0);

340 ià(
rv
<0) {

341 
	`w¬n
("UH-OH:ƒ¼Ü wa™šg fÜ chd 0 (pid %d)", 
pids
[0]);

343 
rv
 = 
	`wa™pid
(
pids
[1], &
x
, 0);

344 ià(
rv
<0) {

345 
	`w¬n
("UH-OH:ƒ¼Ü wa™šg fÜ chd 1 (pid %d)", 
pids
[1]);

347 
	`w¬nx
("passed: siblings wait forƒach other");

348 
	`şo£
(
fd
);

349 
	`şo£
(
£mfd
);

350 
	`»move
(
£mÇme
);

351 
	`»move
(
TESTFILE
);

352 
	}
}

357 
	$‹¡_wa™pid
()

359 
	`wa™_badpid
(-8, "wait for…id -8");

360 
	`wa™_badpid
(-1, "wait for…id -1");

361 
	`wa™_badpid
(0, "pid zero");

362 
	`wa™_badpid
(
NONEXIST_PID
, "nonexistent…id");

364 
	`wa™_nuÎ¡©us
();

365 
	`wa™_bad¡©us
(
INVAL_PTR
, "wait with invalid…ointer status");

366 
	`wa™_bad¡©us
(
KERN_PTR
, "wait with kernel…ointer status");

368 
	`wa™_uÇligÃd
();

370 
	`wa™_badæags
();

372 
	`wa™_£lf
();

373 
	`wa™_·»Á
();

374 
	`wa™_siblšgs
();

375 
	}
}

	@bad_write.c

34 
	~"‹¡.h
"

37 
	$‹¡_wr™e
()

39 
	`‹¡_wr™e_fd
();

40 
	`‹¡_wr™e_buf
();

41 
	}
}

	@common_buf.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<lim™s.h
>

41 
	~<”ºo.h
>

42 
	~<”r.h
>

44 
	~"cÚfig.h
"

45 
	~"‹¡.h
"

47 
	gbuf_fd
;

49 
	sbuáe¡
 {

50 (*
	m£tup
)();

51 (*
	mİ
)(*);

52 (*
	mş—nup
)();

53 cÚ¡ *
	mÇme
;

60 
	$»ad_£tup
()

62 
buf_fd
 = 
	`İ’_‹¡fe
("i do‚ot†ike greenƒggs‡nd ham");

63 ià(
buf_fd
<0) {

67 
	}
}

71 
	$»ad_badbuf
(*
buf
)

73  
	`»ad
(
buf_fd
, 
buf
, 128);

74 
	}
}

78 
	$»ad_ş—nup
()

80 
	`şo£
(
buf_fd
);

81 
	`»move
(
TESTFILE
);

82 
	}
}

88 
	$wr™e_£tup
()

90 
buf_fd
 = 
	`İ’_‹¡fe
(
NULL
);

91 ià(
buf_fd
<0) {

95 
	}
}

99 
	$wr™e_badbuf
(*
±r
)

101  
	`wr™e
(
buf_fd
, 
±r
, 128);

102 
	}
}

106 
	$wr™e_ş—nup
()

108 
	`şo£
(
buf_fd
);

109 
	`»move
(
TESTFILE
);

110 
	}
}

116 
	$g‘dœ’Œy_£tup
()

118 
buf_fd
 = 
	`İ’
(".", 
O_RDONLY
);

119 ià(
buf_fd
 < 0) {

120 
	`w¬n
("UH-OH: couldn't open .");

124 
	}
}

128 
	$g‘dœ’Œy_badbuf
(*
±r
)

130  
	`g‘dœ’Œy
(
buf_fd
, 
±r
, 1024);

131 
	}
}

135 
	$g‘dœ’Œy_ş—nup
()

137 
	`şo£
(
buf_fd
);

138 
	}
}

144 
	$»adlšk_£tup
()

146  
	`ü—‹_‹¡lšk
();

147 
	}
}

151 
	$»adlšk_badbuf
(*
buf
)

153  
	`»adlšk
(
TESTLINK
, 
buf
, 168);

154 
	}
}

158 
	$»adlšk_ş—nup
()

160 
	`»move
(
TESTLINK
);

161 
	}
}

165 
	$g‘cwd_£tup
(è{  0; 
	}
}

166 
	$g‘cwd_ş—nup
(è{
	}
}

170 
	$g‘cwd_badbuf
(*
buf
)

172  
	`__g‘cwd
(
buf
, 408);

173 
	}
}

179 
	$commÚ_badbuf
(
buáe¡
 *
šfo
, *
buf
, cÚ¡ *
bufdesc
)

181 
mydesc
[128];

182 
rv
;

184 
	`¢´štf
(
mydesc
, (mydesc), "%s with %s buffer",

185 
šfo
->
Çme
, 
bufdesc
);

186 
šfo
->
	`£tup
();

187 
rv
 = 
šfo
->
	`İ
(
buf
);

188 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EFAULT
, 
mydesc
);

189 
šfo
->
	`ş—nup
();

190 
	}
}

194 
	$ªy_badbuf
(
buáe¡
 *
šfo
)

196 
	`commÚ_badbuf
(
šfo
, 
NULL
, "NULL");

197 
	`commÚ_badbuf
(
šfo
, 
INVAL_PTR
, "invalid");

198 
	`commÚ_badbuf
(
šfo
, 
KERN_PTR
, "kernel-space");

199 
	}
}

203 
	#T
(
ÿÎ
) \

205 
‹¡_
##
ÿÎ
##
	`_buf
() \

207 
buáe¡
 
šfo
 = { \

208 
ÿÎ
##
_£tup
, \

209 
ÿÎ
##
_badbuf
, \

210 
ÿÎ
##
_ş—nup
, \

213 
	`ªy_badbuf
(&
šfo
); \

214 }

	)

216 
T
(
»ad
);

217 
T
(
wr™e
);

218 
T
(
g‘dœ’Œy
);

219 
T
(
»adlšk
);

220 
T
(
g‘cwd
);

	@common_fds.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<lim™s.h
>

41 
	~<”ºo.h
>

42 
	~<”r.h
>

44 
	~"cÚfig.h
"

45 
	~"‹¡.h
"

48 
	erw‹¡modes
 {

49 
	mRW_TEST_NONE
,

50 
	mRW_TEST_RDONLY
,

51 
	mRW_TEST_WRONLY
,

56 
	$»ad_badfd
(
fd
)

58 
buf
[128];

59  
	`»ad
(
fd
, 
buf
, (buf));

60 
	}
}

64 
	$wr™e_badfd
(
fd
)

66 
buf
[128];

67 
	`mem£t
(
buf
, 'a', (buf));

68  
	`wr™e
(
fd
, 
buf
, (buf));

69 
	}
}

74 
	$şo£_badfd
(
fd
)

76  
	`şo£
(
fd
);

77 
	}
}

81 
	$ioùl_badfd
(
fd
)

83  
	`ioùl
(
fd
, 0, 
NULL
);

84 
	}
}

88 
	$l£ek_badfd
(
fd
)

90  
	`l£ek
(
fd
, 0, 
SEEK_SET
);

91 
	}
}

95 
	$fsync_badfd
(
fd
)

97  
	`fsync
(
fd
);

98 
	}
}

102 
	$árunÿ‹_badfd
(
fd
)

104  
	`árunÿ‹
(
fd
, 60);

105 
	}
}

109 
	$f¡©_badfd
(
fd
)

111 
¡©
 
sb
;

112  
	`f¡©
(
fd
, &
sb
);

113 
	}
}

117 
	$g‘dœ’Œy_badfd
(
fd
)

119 
buf
[32];

120  
	`g‘dœ’Œy
(
fd
, 
buf
, (buf));

121 
	}
}

125 
	$dup2_badfd
(
fd
)

128  
	`dup2
(
fd
, 
CLOSED_FD
+1);

129 
	}
}

133 
	$dup2_ş—nup
()

135 
	`şo£
(
CLOSED_FD
+1);

136 
	}
}

142 
ªy_badfd
((*
func
)(
fd
), (*
ş—nup
)(), cÚ¡ *
ÿÎÇme
,

143 
fd
, cÚ¡ *
fddesc
)

145 
fuÎdesc
[128];

146 
rv
;

148 
	`¢´štf
(
fuÎdesc
, (fuÎdesc), "% usšg %s", 
ÿÎÇme
, 
fddesc
);

149 
rv
 = 
	`func
(
fd
);

150 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EBADF
, 
fuÎdesc
);

151 ià(
ş—nup
) {

152 
	`ş—nup
();

154 
	}
}

158 
ruÁe¡
((*
func
)(
fd
), (*
ş—nup
)(), cÚ¡ *
ÿÎÇme
,

159 
rw‹¡modes
 
rw
)

161 
fd
;

168 
	`ªy_badfd
(
func
, 
ş—nup
, 
ÿÎÇme
, -1, "fd -1");

171 
	`ªy_badfd
(
func
, 
ş—nup
, 
ÿÎÇme
, -5, "fd -5");

174 
	`ªy_badfd
(
func
, 
ş—nup
, 
ÿÎÇme
, 
CLOSED_FD
, "closed fd");

177 
	`ªy_badfd
(
func
, 
ş—nup
, 
ÿÎÇme
, 
IMPOSSIBLE_FD
, "impossible fd");

180 #ifdeà
OPEN_MAX


181 
	`ªy_badfd
(
func
, 
ş—nup
, 
ÿÎÇme
, 
OPEN_MAX
, "fd OPEN_MAX");

183 
	`w¬nx
("Warning: OPEN_MAX‚ot defined,est skipped");

186 ià(
rw
 =ğ
RW_TEST_RDONLY
) {

187 
fd
 = 
	`»İ’_‹¡fe
(
O_RDONLY
|
O_CREAT
);

188 ià(
fd
 < 0) {

192 
	`ªy_badfd
(
func
, 
ş—nup
, 
ÿÎÇme
, 
fd
,

195 
	`şo£
(
fd
);

197 ià(
rw
 =ğ
RW_TEST_WRONLY
) {

198 
fd
 = 
	`»İ’_‹¡fe
(
O_WRONLY
|
O_CREAT
);

199 ià(
fd
 < 0) {

203 
	`ªy_badfd
(
func
, 
ş—nup
, 
ÿÎÇme
, 
fd
,

206 
	`şo£
(
fd
);

208 
	}
}

212 
	#T
(
ÿÎ
, 
rw
) \

214 
‹¡_
##
ÿÎ
##
	`_fd
() \

216 
	`ruÁe¡
(
ÿÎ
##
_badfd
, 
NULL
, #ÿÎ, 
rw
); \

217 }

	)

219 
	#TC
(
ÿÎ
, 
rw
) \

221 
‹¡_
##
ÿÎ
##
	`_fd
() \

223 
	`ruÁe¡
(
ÿÎ
##
_badfd
, c®l##
_ş—nup
, #ÿÎ, 
rw
);\

224 }

	)

226 
T
(
»ad
, 
RW_TEST_WRONLY
);

227 
T
(
wr™e
, 
RW_TEST_RDONLY
);

228 
T
(
şo£
, 
RW_TEST_NONE
);

229 
T
(
ioùl
, 
RW_TEST_NONE
);

230 
T
(
l£ek
, 
RW_TEST_NONE
);

231 
T
(
fsync
, 
RW_TEST_NONE
);

232 
T
(
árunÿ‹
, 
RW_TEST_RDONLY
);

233 
T
(
f¡©
, 
RW_TEST_NONE
);

234 
T
(
g‘dœ’Œy
, 
RW_TEST_WRONLY
);

235 
TC
(
dup2
, 
RW_TEST_NONE
);

	@common_path.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<lim™s.h
>

41 
	~<”ºo.h
>

42 
	~<”r.h
>

44 
	~"cÚfig.h
"

45 
	~"‹¡.h
"

49 
	$İ’_bad·th
(cÚ¡ *
·th
)

51  
	`İ’
(
·th
, 
O_RDONLY
);

52 
	}
}

56 
	$»move_bad·th
(cÚ¡ *
·th
)

58  
	`»move
(
·th
);

59 
	}
}

63 
	$»Çme_bad·th1
(cÚ¡ *
·th
)

65  
	`»Çme
(
·th
, 
TESTFILE
);

66 
	}
}

70 
	$»Çme_bad·th2
(cÚ¡ *
·th
)

72  
	`»Çme
(
TESTFILE
, 
·th
);

73 
	}
}

77 
	$lšk_bad·th1
(cÚ¡ *
·th
)

79  
	`lšk
(
·th
, 
TESTFILE
);

80 
	}
}

84 
	$lšk_bad·th2
(cÚ¡ *
·th
)

86  
	`lšk
(
TESTFILE
, 
·th
);

87 
	}
}

91 
	$mkdœ_bad·th
(cÚ¡ *
·th
)

93  
	`mkdœ
(
·th
, 0775);

94 
	}
}

98 
	$rmdœ_bad·th
(cÚ¡ *
·th
)

100  
	`rmdœ
(
·th
);

101 
	}
}

105 
	$chdœ_bad·th
(cÚ¡ *
·th
)

107  
	`chdœ
(
·th
);

108 
	}
}

112 
	$symlšk_bad·th1
(cÚ¡ *
·th
)

114  
	`symlšk
(
·th
, 
TESTFILE
);

115 
	}
}

119 
	$symlšk_bad·th2
(cÚ¡ *
·th
)

121  
	`symlšk
(
TESTFILE
, 
·th
);

122 
	}
}

126 
	$»adlšk_bad·th
(cÚ¡ *
·th
)

128 
buf
[128];

129  
	`»adlšk
(
·th
, 
buf
, (buf));

130 
	}
}

134 
	$l¡©_bad·th
(cÚ¡ *
Çme
)

136 
¡©
 
sb
;

137  
	`l¡©
(
Çme
, &
sb
);

138 
	}
}

142 
	$¡©_bad·th
(cÚ¡ *
Çme
)

144 
¡©
 
sb
;

145  
	`¡©
(
Çme
, &
sb
);

146 
	}
}

152 
commÚ_bad·th
((*
func
)(cÚ¡ *
·th
), 
mk
, 
rm
, const *path,

153 cÚ¡ *
ÿÎ
, cÚ¡ *
·thdesc
)

155 
mydesc
[128];

156 
rv
;

158 ià(
mk
) {

159 ià(
	`ü—‹_‹¡fe
()<0) {

164 
	`¢´štf
(
mydesc
, (mydesc), "% w™h % ·th", 
ÿÎ
, 
·thdesc
);

165 
rv
 = 
	`func
(
·th
);

166 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EFAULT
, 
mydesc
);

168 ià(
mk
 || 
rm
) {

169 
	`»move
(
TESTFILE
);

171 
	}
}

175 
ªy_bad·th
((*
func
)(cÚ¡ *
·th
), cÚ¡ *
ÿÎ
, 
mk
, 
rm
)

177 
	`commÚ_bad·th
(
func
, 
mk
, 
rm
, 
NULL
, 
ÿÎ
, "NULL");

178 
	`commÚ_bad·th
(
func
, 
mk
, 
rm
, 
INVAL_PTR
, 
ÿÎ
, "invalid-pointer");

179 
	`commÚ_bad·th
(
func
, 
mk
, 
rm
, 
KERN_PTR
, 
ÿÎ
, "kernel-pointer");

180 
	}
}

185 
	#T
(
ÿÎ
) \

187 
‹¡_
##
ÿÎ
##
	`_·th
() \

189 
	`ªy_bad·th
(
ÿÎ
##
_bad·th
, #call, 0, 0); \

190 }

	)

192 
T
(
İ’
);

193 
T
(
»move
);

194 
T
(
mkdœ
);

195 
T
(
rmdœ
);

196 
T
(
chdœ
);

197 
T
(
»adlšk
);

198 
T
(
¡©
);

199 
T
(
l¡©
);

202 
	#T2
(
ÿÎ
) \

204 
‹¡_
##
ÿÎ
##
	`_·ths
() \

206 
	`ªy_bad·th
(
ÿÎ
##
_bad·th1
, #call "(arg1)", 0, 1); \

207 
	`ªy_bad·th
(
ÿÎ
##
_bad·th2
, #call "(arg2)", 1, 1); \

208 }

	)

210 
T2
(
»Çme
);

211 
T2
(
lšk
);

212 
T2
(
symlšk
);

	@config.h

37 #ià
defšed
(
__ms__
)

38 
	#KERN_PTR
 ((*)0x80000000è

	)

39 
	#INVAL_PTR
 ((*)0x40000000è

	)

48 
	#CLOSED_FD
 10

	)

51 
	#IMPOSSIBLE_FD
 1234567890

	)

54 
	#NONEXIST_PID
 34000

	)

57 
	#MAGIC_STATUS
 107

	)

60 
	#NONEXIST_IOCTL
 12345

	)

	@driver.c

30 
	~<sys/ty³s.h
>

31 
	~<sys/¡©.h
>

32 
	~<¡dio.h
>

33 
	~<¡dlib.h
>

34 
	~<¡ršg.h
>

35 
	~<uni¡d.h
>

36 
	~<”ºo.h
>

37 
	~<”r.h
>

39 
	~"cÚfig.h
"

40 
	~"‹¡.h
"

46 
	$fšd”rÜ
(
rv
, 
”rÜ
)

48 ià(
rv
==-1) {

49  
”rÜ
;

54 
	}
}

57 
	$»pÜt_surviv®
(
rv
, 
”rÜ
, cÚ¡ *
desc
)

60 
”ºo
 = 
	`fšd”rÜ
(
rv
, 
”rÜ
);

61 
	`w¬n
("·s£d: %s", 
desc
);

62 
	}
}

66 
	$»pÜt_‹¡N
(
rv
, 
”rÜ
, *
right_”rÜs
, 
right_num
,

67 cÚ¡ *
desc
)

69 
i
, 
gÙ”rÜ
;

71 
gÙ”rÜ
 = 
	`fšd”rÜ
(
rv
, 
”rÜ
);

73 
i
=0; i<
right_num
; i++) {

74 ià(
gÙ”rÜ
 =ğ
right_”rÜs
[
i
]) {

75 
	`w¬nx
("·s£d: %s", 
desc
);

80 ià(
gÙ”rÜ
 =ğ
ENOSYS
) {

81 
	`w¬nx
("------: % (unim¶em’‹d)", 
desc
);

84 
”ºo
 = 
gÙ”rÜ
;

85 
	`w¬n
("FAILURE: %s", 
desc
);

87 
	}
}

90 
	$»pÜt_‹¡
(
rv
, 
”rÜ
, 
right_”rÜ
, cÚ¡ *
desc
)

92 
	`»pÜt_‹¡N
(
rv
, 
”rÜ
, &
right_”rÜ
, 1, 
desc
);

93 
	}
}

96 
	$»pÜt_‹¡2
(
rv
, 
”rÜ
, 
ok”r1
, 
ok”r2
, cÚ¡ *
desc
)

98 
ok
[2];

100 
ok
[0] = 
ok”r1
;

101 
ok
[1] = 
ok”r2
;

102 
	`»pÜt_‹¡N
(
rv
, 
”rÜ
, 
ok
, 2, 
desc
);

103 
	}
}

106 
	$»pÜt_‹¡3
(
rv
, 
”rÜ
, 
ok”r1
, 
ok”r2
, 
ok”r3
,

107 cÚ¡ *
desc
)

109 
ok
[3];

111 
ok
[0] = 
ok”r1
;

112 
ok
[1] = 
ok”r2
;

113 
ok
[2] = 
ok”r3
;

114 
	`»pÜt_‹¡N
(
rv
, 
”rÜ
, 
ok
, 3, 
desc
);

115 
	}
}

120 
	$İ’_‹¡fe
(cÚ¡ *
¡ršg
)

122 
fd
, 
rv
;

123 
size_t
 
Ën
;

125 
fd
 = 
	`İ’
(
TESTFILE
, 
O_RDWR
|
O_CREAT
|
O_TRUNC
, 0664);

126 ià(
fd
<0) {

127 
	`w¬n
("UH-OH: c»©šg %s: faed", 
TESTFILE
);

131 ià(
¡ršg
) {

132 
Ën
 = 
	`¡¾’
(
¡ršg
);

133 
rv
 = 
	`wr™e
(
fd
, 
¡ršg
, 
Ën
);

134 ià(
rv
<0) {

135 
	`w¬n
("UH-OH: wr™tØ% çed", 
TESTFILE
);

136 
	`şo£
(
fd
);

137 
	`»move
(
TESTFILE
);

140 ià(()
rv
 !ğ
Ën
) {

141 
	`w¬nx
("UH-OH: wr™tØ% gÙ shÜˆcouÁ", 
TESTFILE
);

142 
	`şo£
(
fd
);

143 
	`»move
(
TESTFILE
);

146 
rv
 = 
	`l£ek
(
fd
, 0, 
SEEK_SET
);

147 ià(
rv
<0) {

148 
	`w¬n
("UH-OH:„ewšd oà% çed", 
TESTFILE
);

149 
	`şo£
(
fd
);

150 
	`»move
(
TESTFILE
);

154  
fd
;

155 
	}
}

158 
	$ü—‹_‹¡fe
()

160 
fd
, 
rv
;

162 
fd
 = 
	`İ’_‹¡fe
(
NULL
);

163 ià(
fd
<0) {

167 
rv
 = 
	`şo£
(
fd
);

168 ià(
rv
<0) {

169 
	`w¬n
("UH-OH: closšg % çed", 
TESTFILE
);

174 
	}
}

177 
	$»İ’_‹¡fe
(
İ’æags
)

179 
fd
;

181 
fd
 = 
	`İ’
(
TESTFILE
, 
İ’æags
, 0664);

182 ià(
fd
 < 0) {

183 
	`w¬n
("UH-OH:„eİ’šg %s: faed", 
TESTFILE
);

186  
fd
;

187 
	}
}

190 
	$ü—‹_‹¡dœ
()

192 
rv
;

193 
rv
 = 
	`mkdœ
(
TESTDIR
, 0775);

194 ià(
rv
<0) {

195 ià(
”ºo
 =ğ
ENOSYS
) {

196 
	`w¬nx
("------: mkdir unimplemented; cannot„unest");

199 
	`w¬n
("UH-OH: mkdœ % çed", 
TESTDIR
);

204 
	}
}

207 
	$ü—‹_‹¡lšk
()

209 
rv
;

210 
rv
 = 
	`symlšk
("bÏhbÏh", 
TESTLINK
);

211 ià(
rv
<0) {

212 
	`w¬n
("UH-OH: makšg symlšk % çed", 
TESTLINK
);

216 
	}
}

222 
	mch
;

223 
	mas¡
;

224 cÚ¡ *
	mÇme
;

225 (*
	mf
)();

226 } 
	gİs
[] = {

227 { 'a', 2, "execv", 
‹¡_execv
 },

228 { 'b', 2, "wa™pid", 
‹¡_wa™pid
 },

229 { 'c', 2, "İ’", 
‹¡_İ’
 },

230 { 'd', 2, "»ad", 
‹¡_»ad
 },

231 { 'e', 2, "wr™e", 
‹¡_wr™e
 },

232 { 'f', 2, "şo£", 
‹¡_şo£
 },

233 { 'g', 0, "»boÙ", 
‹¡_»boÙ
 },

234 { 'h', 3, "sbrk", 
‹¡_sbrk
 },

235 { 'i', 5, "ioùl", 
‹¡_ioùl
 },

236 { 'j', 2, "l£ek", 
‹¡_l£ek
 },

237 { 'k', 4, "fsync", 
‹¡_fsync
 },

238 { 'l', 4, "árunÿ‹", 
‹¡_árunÿ‹
 },

239 { 'm', 4, "f¡©", 
‹¡_f¡©
 },

240 { 'n', 4, "»move", 
‹¡_»move
 },

241 { 'o', 4, "»Çme", 
‹¡_»Çme
 },

242 { 'p', 5, "lšk", 
‹¡_lšk
 },

243 { 'q', 4, "mkdœ", 
‹¡_mkdœ
 },

244 { 'r', 4, "rmdœ", 
‹¡_rmdœ
 },

245 { 's', 2, "chdœ", 
‹¡_chdœ
 },

246 { 't', 4, "g‘dœ’Œy", 
‹¡_g‘dœ’Œy
 },

247 { 'u', 5, "symlšk", 
‹¡_symlšk
 },

248 { 'v', 5, "»adlšk", 
‹¡_»adlšk
 },

249 { 'w', 2, "dup2", 
‹¡_dup2
 },

250 { 'x', 5, "pe", 
‹¡_pe
 },

251 { 'y', 5, "__time", 
‹¡_time
 },

252 { 'z', 2, "__g‘cwd", 
‹¡_g‘cwd
 },

253 { '{', 5, "¡©", 
‹¡_¡©
 },

254 { '|', 5, "l¡©", 
‹¡_l¡©
 },

255 { 0, 0, 
NULL
, NULL }

258 
	#LOWEST
 'a'

	)

259 
	#HIGHEST
 '|'

	)

263 
	$m’u
()

265 
i
;

266 
i
=0; 
İs
[i].
Çme
; i++) {

267 
	`´štf
("[%c] %-24s", 
İs
[
i
].
ch
, ops[i].
Çme
);

268 ià(
i
%2==1) {

269 
	`´štf
("\n");

272 ià(
i
%2==1) {

273 
	`´štf
("\n");

275 
	`´štf
("[1] %-24s", "asst1");

276 
	`´štf
("[2] %-24s\n", "asst2");

277 
	`´štf
("[3] %-24s", "asst3");

278 
	`´štf
("[4] %-24s\n", "asst4");

279 
	`´štf
("[*] %-24s", "all");

280 
	`´štf
("[!] %-24s\n", "quit");

281 
	}
}

285 
	$run™
(
İ
)

287 
i
, 
k
;

289 ià(
İ
=='!') {

290 
	`ex™
(0);

293 ià(
İ
=='?') {

294 
	`m’u
();

298 ià(
İ
=='*') {

299 
i
=0; 
İs
[i].
Çme
; i++) {

300 
	`´štf
("[%s]\n", 
İs
[
i
].
Çme
);

301 
İs
[
i
].
	`f
();

306 ià(
İ
>='1' && op <= '4') {

307 
k
 = 
İ
-'0';

308 
i
=0; 
İs
[i].
Çme
; i++) {

309 ià(
İs
[
i
].
as¡
 <ğ
k
) {

310 
	`´štf
("[%s]\n", 
İs
[
i
].
Çme
);

311 
İs
[
i
].
	`f
();

317 ià(
İ
 < 
LOWEST
 || o°> 
HIGHEST
) {

318 
	`´štf
("Inv®id„eque¡ %c\n", 
İ
);

322 
İs
[
İ
-'a'].
	`f
();

323 
	}
}

326 
	$maš
(
¬gc
, **
¬gv
)

328 
İ
, 
i
, 
j
;

330 
	`´štf
("[%c-%c, 1-4, *, ?=m’u, !=qu™]\n", 
LOWEST
, 
HIGHEST
);

332 ià(
¬gc
 > 1) {

333 
i
=1; i<
¬gc
; i++) {

334 
j
=0; 
¬gv
[
i
][j]; j++) {

335 
	`´štf
("Choose: %c\n",

336 
¬gv
[
i
][
j
]);

337 
	`run™
(
¬gv
[
i
][
j
]);

342 
	`m’u
();

344 
	`´štf
("Choose: ");

345 
İ
 = 
	`g‘ch¬
();

346 ià(
İ
==
EOF
) {

349 
	`´štf
("%c\n", 
İ
);

350 
	`run™
(
İ
);

355 
	}
}

	@test.h

30 
	#TESTFILE
 "badÿÎfe"

	)

31 
	#TESTDIR
 "badÿÎdœ"

	)

32 
	#TESTLINK
 "badÿÎlšk"

	)

35 
»pÜt_surviv®
(
rv
, 
”rÜ
, cÚ¡ *
desc
);

36 
»pÜt_‹¡
(
rv
, 
”rÜ
, 
right_”rÜ
, cÚ¡ *
desc
);

37 
»pÜt_‹¡2
(
rv
, 
”rÜ
, 
ok”r1
, 
ok”r2
, cÚ¡ *
desc
);

38 
»pÜt_‹¡3
(
rv
, 
”rÜ
, 
ok”r1
, 
ok”r2
, 
ok”r3
,

39 cÚ¡ *
desc
);

40 
İ’_‹¡fe
(cÚ¡ *
¡r
);

41 
»İ’_‹¡fe
(
İ’æags
);

42 
ü—‹_‹¡fe
();

43 
ü—‹_‹¡dœ
();

44 
ü—‹_‹¡lšk
();

47 
‹¡_»ad_buf
();

48 
‹¡_wr™e_buf
();

49 
‹¡_g‘dœ’Œy_buf
();

50 
‹¡_g‘cwd_buf
();

51 
‹¡_»adlšk_buf
();

54 
‹¡_»ad_fd
();

55 
‹¡_wr™e_fd
();

56 
‹¡_şo£_fd
();

57 
‹¡_ioùl_fd
();

58 
‹¡_l£ek_fd
();

59 
‹¡_fsync_fd
();

60 
‹¡_árunÿ‹_fd
();

61 
‹¡_f¡©_fd
();

62 
‹¡_g‘dœ’Œy_fd
();

63 
‹¡_dup2_fd
();

66 
‹¡_İ’_·th
();

67 
‹¡_»move_·th
();

68 
‹¡_»Çme_·ths
();

69 
‹¡_lšk_·ths
();

70 
‹¡_mkdœ_·th
();

71 
‹¡_rmdœ_·th
();

72 
‹¡_chdœ_·th
();

73 
‹¡_symlšk_·ths
();

74 
‹¡_»adlšk_·th
();

75 
‹¡_¡©_·th
();

76 
‹¡_l¡©_·th
();

79 
‹¡_execv
();

80 
‹¡_wa™pid
();

81 
‹¡_İ’
();

82 
‹¡_»ad
();

83 
‹¡_wr™e
();

84 
‹¡_şo£
();

85 
‹¡_»boÙ
();

86 
‹¡_sbrk
();

87 
‹¡_ioùl
();

88 
‹¡_l£ek
();

89 
‹¡_fsync
();

90 
‹¡_árunÿ‹
();

91 
‹¡_f¡©
();

92 
‹¡_»move
();

93 
‹¡_»Çme
();

94 
‹¡_lšk
();

95 
‹¡_mkdœ
();

96 
‹¡_rmdœ
();

97 
‹¡_chdœ
();

98 
‹¡_g‘dœ’Œy
();

99 
‹¡_symlšk
();

100 
‹¡_»adlšk
();

101 
‹¡_dup2
();

102 
‹¡_pe
();

103 
‹¡_time
();

104 
‹¡_g‘cwd
();

105 
‹¡_¡©
();

106 
‹¡_l¡©
();

	@
1
.
0
32
390
bad_chdir.c
bad_close.c
bad_dup2.c
bad_execv.c
bad_fsync.c
bad_ftruncate.c
bad_getcwd.c
bad_getdirentry.c
bad_ioctl.c
bad_link.c
bad_lseek.c
bad_mkdir.c
bad_open.c
bad_pipe.c
bad_read.c
bad_readlink.c
bad_reboot.c
bad_remove.c
bad_rename.c
bad_rmdir.c
bad_sbrk.c
bad_stat.c
bad_symlink.c
bad_time.c
bad_waitpid.c
bad_write.c
common_buf.c
common_fds.c
common_path.c
config.h
driver.c
test.h
